; ############################################################################
; T.B. Moraes, et al.; Steady-State Free Precession sequences for high and low field 
; NMR spectroscopy in solution: Challenges and opportunities, JMRO, 2022.
; Quadratic phase increment SSFP (SSFPdxdt) using A = pi/256
; 1D sequence with power-gated decoupling
; ############################################################################
; Set:  DS = 1 ; NS = 1;  d3 = Aq + d1; 
; Recommended values: d1 = 0.01001 ms (minimum); Aq = 0.189 ms; d3 = 0.2 ms;
; L0 - dummy scan of each phase increment block; 
; L1 - scan in each phase increment block;  L0 e L1 need to be multiple of 256;

#include <Avance.incl>
#include <Delay.incl>

"d11=30m"
"DELTA=d1-10m"
"acqt0=-p1*0.66/3.1416"

1 ze
  d11 pl12:f2
2 30m do:f2
  10u pl13:f2
  d11 cpd2:f2
  DELTA
  4u do:f2
  10u pl12:f2
  100m cpd2:f2

3  (p1 pl1 ph1^):f1
   d3 
   lo to 3 times l0
4  (p1 pl1 ph1^):f1
   gosc ph31 
   d1 ipp31
   lo to 4 times l1
 
  30m do:f2 pl13:f2 mc #0 to 2 F0(zd)
exit


; Phase table for A = (pi/256)
ph1 = (512) 0 1 4 9 16 25 36 49 64 81 100 121 144 169 196 225 256 289 324 361 400 441 484 17 64 113 164 217 272
329 388 449 0 65 132 201 272 345 420 497 64 145 228 313 400 489 68 161 256 353 452 41 144 249 356 465 64
177 292 409 16 137 260 385 0 129 260 393 16 153 292 433 64 209 356 505 144 297 452 97 256 417 68 233 400
57 228 401 64 241 420 89 272 457 132 321 0 193 388 73 272 473 164 369 64 273 484 185 400 105 324 33 256
481 196 425 144 377 100 337 64 305 36 281 16 265 4 257 0 257 4 265 16 281 36 305 64 337 100 377 144
425 196 481 256 33 324 105 400 185 484 273 64 369 164 473 272 73 388 193 0 321 132 457 272 89 420 241 64
401 228 57 400 233 68 417 256 97 452 297 144 505 356 209 64 433 292 153 16 393 260 129 0 385 260 137 16
409 292 177 64 465 356 249 144 41 452 353 256 161 68 489 400 313 228 145 64 497 420 345 272 201 132 65 0
449 388 329 272 217 164 113 64 17 484 441 400 361 324 289 256 225 196 169 144 121 100 81 64 49 36 25 16 9 4 1

ph31 = (512) 0 1 4 9 16 25 36 49 64 81 100 121 144 169 196 225 256 289 324 361 400 441 484 17 64 113 164 217 272
329 388 449 0 65 132 201 272 345 420 497 64 145 228 313 400 489 68 161 256 353 452 41 144 249 356 465 64
177 292 409 16 137 260 385 0 129 260 393 16 153 292 433 64 209 356 505 144 297 452 97 256 417 68 233 400
57 228 401 64 241 420 89 272 457 132 321 0 193 388 73 272 473 164 369 64 273 484 185 400 105 324 33 256
481 196 425 144 377 100 337 64 305 36 281 16 265 4 257 0 257 4 265 16 281 36 305 64 337 100 377 144
425 196 481 256 33 324 105 400 185 484 273 64 369 164 473 272 73 388 193 0 321 132 457 272 89 420 241 64
401 228 57 400 233 68 417 256 97 452 297 144 505 356 209 64 433 292 153 16 393 260 129 0 385 260 137 16
409 292 177 64 465 356 249 144 41 452 353 256 161 68 489 400 313 228 145 64 497 420 345 272 201 132 65 0
449 388 329 272 217 164 113 64 17 484 441 400 361 324 289 256 225 196 169 144 121 100 81 64 49 36 25 16 9 4 1

; Best phase table options are A=pi/256 and A=pi/512, these other are only for curious
;A = (pi/128)
;ph1= (256) 0 1 4 9 16 25 36 49 64 81 100 121 144 169 196 225 0 33 68 105 144 185 228 17 64 113 164 217 16 73 132 193 0 65 132 201 16 89 164 241 64 145 228 57 144 233 68 161 0 97 196 41 144 249 100 209 64 177 36 153 16 137 4 129 0 129 4 137 16 153 36 177 64 209 100 249 144 41 196 97 0 161 68 233 144 57 228 145 64 241 164 89 16 201 132 65 0 193 132 73 16 217 164 113 64 17 228 185 144 105 68 33 0 225 196 169 144 121 100 81 64 49 36 25 16 9 4 1
;ph31=(256) 0 1 4 9 16 25 36 49 64 81 100 121 144 169 196 225 0 33 68 105 144 185 228 17 64 113 164 217 16 73 132 193 0 65 132 201 16 89 164 241 64 145 228 57 144 233 68 161 0 97 196 41 144 249 100 209 64 177 36 153 16 137 4 129 0 129 4 137 16 153 36 177 64 209 100 249 144 41 196 97 0 161 68 233 144 57 228 145 64 241 164 89 16 201 132 65 0 193 132 73 16 217 164 113 64 17 228 185 144 105 68 33 0 225 196 169 144 121 100 81 64 49 36 25 16 9 4 1

;A = (pi/64)
;ph1= (128) 0 1 4 9 16 25 36 49 64 81 100 121 16 41 68 97 0 33 68 105 16 57 100 17 64 113 36 89 16 73 4 65 0 65 4 73 16 89 36 113 64 17 100 57 16 105 68 33 0 97 68 41 16 121 100 81 64 49 36 25 16 9 4 1
;ph31=(128) 0 1 4 9 16 25 36 49 64 81 100 121 16 41 68 97 0 33 68 105 16 57 100 17 64 113 36 89 16 73 4 65 0 65 4 73 16 89 36 113 64 17 100 57 16 105 68 33 0 97 68 41 16 121 100 81 64 49 36 25 16 9 4 1  

;A = (pi/32)
;ph1= (64) 0 1 4 9 16 25 36 49 0 17 36 57 16 41 4 33 0 33 4 41 16 57 36 17 0 49 36 25 16 9 4 1
;ph31=(64) 0 1 4 9 16 25 36 49 0 17 36 57 16 41 4 33 0 33 4 41 16 57 36 17 0 49 36 25 16 9 4 1

;A = (pi/16)
;ph1= (32) 0 1 4 9 16 25 4 17 0 17 4 25 16 9 4 1
;ph31=(32) 0 1 4 9 16 25 4 17 0 17 4 25 16 9 4 1

;A = (pi/8)
;ph1= (16) 0 1 4 9 0 9 4 1
;ph31=(16) 0 1 4 9 0 9 4 1

;A = (pi/4)
;ph1= (8) 0 1 4 1
;ph31=(8) 0 1 4 1

;A = (pi/2)
;ph1= (4) 0 1
;ph31=(4) 0 1

;A = (0)
;ph1 = 0
;ph31= 0


; This phase table A = pi/512 some computers do not have enough memory to run. Try A = pi/256
;A = (pi/512)  
;ph1 = (1024) 0 1 4 9 16 25 36 49 64 81 100 121 144 169 196 225 256 289 324 361 400 441 484 529 576 625 676 729 784 841 900 961 0 65 132 201 272 345 420 497 576 657 740 825 912 1001 68 161 256 353 452 553 656 761 868 977 64
;177 292 409 528 649 772 897 0 129 260 393 528 665 804 945 64 209 356 505 656 809 964 97 256 417 580 745 912 57 228 401 576 753 932 89 272 457 644 833 0 193 388 585 784 985 164 369 576 785 996 185 400 617 836 33 256
;481 708 937 144 377 612 849 64 305 548 793 16 265 516 769 0 257 516 777 16 281 548 817 64 337 612 889 144 425 708 993 256 545 836 105 400 697 996 273 576 881 164 473 784 73 388 705 0 321 644 969 272 601 932 241 576
;913 228 569 912 233 580 929 256 609 964 297 656 1017 356 721 64 433 804 153 528 905 260 641 0 385 772 137 528 921 292 689 64 465 868 249 656 41 452 865 256 673 68 489 912 313 740 145 576 1009 420 857 272 713 132 577 0
;449 900 329 784 217 676 113 576 17 484 953 400 873 324 801 256 737 196 681 144 633 100 593 64 561 36 537 16 521 4 513 0 513 4 521 16 537 36 561 64 593 100 633 144 681 196 737 256 801 324 873 400 953 484 17 576
;113 676 217 784 329 900 449 0 577 132 713 272 857 420 1009 576 145 740 313 912 489 68 673 256 865 452 41 656 249 868 465 64 689 292 921 528 137 772 385 0 641 260 905 528 153 804 433 64 721 356 1017 656 297 964 609 256
;929 580 233 912 569 228 913 576 241 932 601 272 969 644 321 0 705 388 73 784 473 164 881 576 273 996 697 400 105 836 545 256 993 708 425 144 889 612 337 64 817 548 281 16 777 516 257 0 769 516 265 16 793 548 305 64
;849 612 377 144 937 708 481 256 33 836 617 400 185 996 785 576 369 164 985 784 585 388 193 0 833 644 457 272 89 932 753 576 401 228 57 912 745 580 417 256 97 964 809 656 505 356 209 64 945 804 665 528 393 260 129 0
;897 772 649 528 409 292 177 64 977 858 761 656 553 452 353 256 161 68 1001 912 825 740 657 576 497 420 345 272 201 132 65 0 961 900 841 784 729 676 625 576 529 484 441 400 361 324 289 256 225 196 169 144 121 100 81 64 49 36 25 16 9 4 1 

;ph31 = (1024) 0 1 4 9 16 25 36 49 64 81 100 121 144 169 196 225 256 289 324 361 400 441 484 529 576 625 676 729 784 841 900 961 0 65 132 201 272 345 420 497 576 657 740 825 912 1001 68 161 256 353 452 553 656 761 868 977 64
;177 292 409 528 649 772 897 0 129 260 393 528 665 804 945 64 209 356 505 656 809 964 97 256 417 580 745 912 57 228 401 576 753 932 89 272 457 644 833 0 193 388 585 784 985 164 369 576 785 996 185 400 617 836 33 256
;481 708 937 144 377 612 849 64 305 548 793 16 265 516 769 0 257 516 777 16 281 548 817 64 337 612 889 144 425 708 993 256 545 836 105 400 697 996 273 576 881 164 473 784 73 388 705 0 321 644 969 272 601 932 241 576
;913 228 569 912 233 580 929 256 609 964 297 656 1017 356 721 64 433 804 153 528 905 260 641 0 385 772 137 528 921 292 689 64 465 868 249 656 41 452 865 256 673 68 489 912 313 740 145 576 1009 420 857 272 713 132 577 0
;449 900 329 784 217 676 113 576 17 484 953 400 873 324 801 256 737 196 681 144 633 100 593 64 561 36 537 16 521 4 513 0 513 4 521 16 537 36 561 64 593 100 633 144 681 196 737 256 801 324 873 400 953 484 17 576
;113 676 217 784 329 900 449 0 577 132 713 272 857 420 1009 576 145 740 313 912 489 68 673 256 865 452 41 656 249 868 465 64 689 292 921 528 137 772 385 0 641 260 905 528 153 804 433 64 721 356 1017 656 297 964 609 256
;929 580 233 912 569 228 913 576 241 932 601 272 969 644 321 0 705 388 73 784 473 164 881 576 273 996 697 400 105 836 545 256 993 708 425 144 889 612 337 64 817 548 281 16 777 516 257 0 769 516 265 16 793 548 305 64
;849 612 377 144 937 708 481 256 33 836 617 400 185 996 785 576 369 164 985 784 585 388 193 0 833 644 457 272 89 932 753 576 401 228 57 912 745 580 417 256 97 964 809 656 505 356 209 64 945 804 665 528 393 260 129 0
;897 772 649 528 409 292 177 64 977 858 761 656 553 452 353 256 161 68 1001 912 825 740 657 576 497 420 345 272 201 132 65 0 961 900 841 784 729 676 625 576 529 484 441 400 361 324 289 256 225 196 169 144 121 100 81 64 49 36 25 16 9 4 1 


